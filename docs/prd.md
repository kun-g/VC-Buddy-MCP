# Vibe Coding Buddy - 产品需求文档 (PRD)

## 📋 文档信息

- **产品名称**: Vibe Coding Buddy - MCP
- **版本**: v0.1.0
- **文档版本**: v1.0
- **创建日期**: 2024年12月
- **最后更新**: 2024年12月

## 🎯 产品概述

### 产品定位
Vibe Coding Buddy 是一个现代化的桌面编程助手，基于 **MCP (Model Context Protocol)** 和 **PySide6** 构建，为开发者提供智能对话、语音交互和项目管理功能。

### 核心价值主张
- **无缝集成**: 通过 MCP 协议与 Claude Desktop 等 AI 助手深度集成
- **智能交互**: 支持文本和语音双模式输入，提升开发效率
- **项目感知**: 自动解析项目 TODO，提供上下文相关的任务管理
- **现代界面**: 基于 Material Design 的响应式 QML 界面

## 👥 目标用户

### 主要用户群体
1. **独立开发者**: 需要高效工具管理个人项目
2. **小团队开发者**: 需要轻量级协作和任务跟踪
3. **AI 辅助编程爱好者**: 希望深度集成 AI 工具到开发流程

### 用户画像
- **技术水平**: 中高级开发者
- **工作环境**: 主要使用 macOS/Linux，部分 Windows
- **开发语言**: Python、JavaScript、Go 等现代语言
- **工具偏好**: 命令行友好，喜欢可定制化工具

## 🚀 功能需求

### 1. MCP 服务器核心功能

#### 1.1 交互式反馈工具
**功能描述**: 提供 `ask_for_feedback` 工具，支持 AI 助手与用户的双向交互

**技术实现**:
- 基于 FastMCP 框架
- 支持 stdio 传输协议
- JSON 格式数据交换

**使用场景**:
- AI 需要用户确认或澄清需求
- 任务完成后需要用户验证结果
- 多选项决策需要用户选择
- 阶段性工作反馈

**接口规范**:
```python
def ask_for_feedback(
    summary: str,           # 必需：反馈请求描述
    project_directory: str  # 可选：项目目录路径
) -> str                   # 返回：JSON格式用户反馈
```

#### 1.2 项目上下文感知
**功能描述**: 自动识别项目目录，提供项目相关的上下文信息

**技术实现**:
- 项目目录自动检测
- TODO.md 文件解析
- 配置文件层级管理

### 2. 桌面 GUI 应用

#### 2.1 Answer Box 界面
**功能描述**: 主要的用户交互界面，支持任务摘要显示和用户反馈输入

**界面组件**:
- **摘要显示区**: 显示 AI 工作总结，支持长文本滚动
- **TODO 列表**: 树形结构显示项目任务，支持状态管理
- **详情面板**: 显示选中任务的详细信息
- **输入区域**: 多行文本输入，支持富文本格式
- **操作按钮**: 发送、语音录制、提交选项

**交互特性**:
- 响应式布局，支持窗口大小调整
- 分割面板，可调整各区域比例
- 键盘快捷键支持 (Ctrl+Enter 发送)
- 窗口位置和大小记忆

#### 2.2 TODO 任务管理
**功能描述**: 集成的项目任务管理系统

**核心功能**:
- **解析 TODO.md**: 支持 Markdown 格式的任务文件
- **层级结构**: 支持多级嵌套任务
- **状态管理**: 完成/未完成状态切换
- **属性支持**: key=value 格式的任务属性
- **实时编辑**: 双击插入任务内容到输入框
- **批量操作**: 标记完成、删除已完成任务

**数据结构**:
```python
class TodoItem:
    title: str              # 任务标题
    content: str            # 任务详细内容
    level: int              # 层级深度
    attributes: Dict[str, str]  # 任务属性
    children: List[TodoItem]    # 子任务列表
    parent: Optional[TodoItem]  # 父任务引用
```

#### 2.3 语音输入功能
**功能描述**: 集成语音录制和转写功能，支持语音输入

**技术实现**:
- **录音引擎**: 基于 PyAudio 的实时录音
- **转写服务**: OpenAI Whisper API 语音转文字
- **多线程处理**: 避免界面阻塞
- **错误处理**: 完善的异常处理和用户提示

**用户体验**:
- 一键开始/停止录音
- 实时录音状态指示
- 自动转写结果插入
- 支持中文语音识别

### 3. 配置管理系统

#### 3.1 层级配置
**功能描述**: 支持多层级的配置文件管理

**配置优先级** (从高到低):
1. 项目目录配置 (`.vc-buddy/config.json`)
2. 环境变量配置 (`VC_BUDDY_CONFIG`)
3. 用户主目录配置 (`~/.vc-buddy/config.json`)
4. 默认配置

**配置项目**:
```json
{
  "app": {
    "organization_name": "VC-Buddy",
    "application_name": "AnswerBox",
    "organization_domain": "vcbuddy.local"
  },
  "ui": {
    "window": {
      "default_width": 623,
      "default_height": 631,
      "remember_position": true,
      "stay_on_top": true
    }
  }
}
```

#### 3.2 环境变量支持
**支持的环境变量**:
- `VC_BUDDY_CONFIG`: 自定义配置文件路径
- `VC_BUDDY_ORG`: 组织名称
- `VC_BUDDY_APP_NAME`: 应用名称
- `VC_BUDDY_DOMAIN`: 组织域名
- `OPENAI_API_KEY`: OpenAI API 密钥

### 4. 样式主题系统

#### 4.1 QML 主题系统
**功能描述**: 基于 Material Design 的统一主题系统

**主题组件**:
- **颜色系统**: 主色调、背景色、文本色等
- **字体系统**: 字体族、大小、权重定义
- **间距系统**: 统一的边距和间距规范
- **圆角系统**: 统一的圆角半径定义

**技术实现**:
```qml
// Theme.qml - 主题单例
QtObject {
    readonly property QtObject colors: QtObject {
        readonly property color primary: "#2196F3"
        readonly property color background: "#FFFFFF"
        readonly property color surface: "#F5F5F5"
        // ... 更多颜色定义
    }
}
```

#### 4.2 QSS 样式系统
**功能描述**: 传统 Qt Widgets 的样式支持

**样式特性**:
- Material Design 风格
- 完整的控件样式覆盖
- 特殊类样式支持
- 动态主题切换

## 🏗️ 技术架构

### 架构概览
```
┌─────────────────┐    ┌─────────────────┐
│   Claude Desktop │    │   MCP Client    │
│                 │◄──►│                 │
└─────────────────┘    └─────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────┐
│           MCP Server (FastMCP)          │
│  ┌─────────────────────────────────────┐│
│  │      ask_for_feedback Tool          ││
│  └─────────────────────────────────────┘│
└─────────────────┬───────────────────────┘
                  │ subprocess
                  ▼
┌─────────────────────────────────────────┐
│         Answer Box GUI (PySide6)        │
│  ┌─────────────┐  ┌─────────────────────┐│
│  │ QML Frontend│  │   Python Backend    ││
│  │             │◄─┤                     ││
│  │ - Main.qml  │  │ - AnswerBoxBackend  ││
│  │ - Theme.qml │  │ - TodoParser        ││
│  │ - Delegates │  │ - VoiceRecorder     ││
│  └─────────────┘  │ - ConfigManager     ││
│                   └─────────────────────┘│
└─────────────────────────────────────────┘
```

### 技术栈

#### 后端技术
- **Python 3.11+**: 主要开发语言
- **FastMCP**: MCP 服务器框架
- **PySide6**: Qt 6 Python 绑定
- **PyAudio**: 音频录制处理
- **OpenAI API**: 语音转写服务

#### 前端技术
- **QML**: 声明式 UI 框架
- **Qt Quick Controls**: UI 控件库
- **Material Design**: 设计语言
- **JavaScript**: QML 逻辑处理

#### 开发工具
- **uv**: 现代 Python 包管理器
- **pytest**: 单元测试框架
- **black/ruff**: 代码格式化和检查
- **mypy**: 静态类型检查

### 数据流

#### MCP 调用流程
1. **AI 助手** 调用 `ask_for_feedback` 工具
2. **MCP 服务器** 接收请求，启动 GUI 进程
3. **Answer Box** 显示摘要，等待用户输入
4. **用户** 提供反馈，点击发送
5. **GUI** 返回 JSON 响应给 MCP 服务器
6. **MCP 服务器** 将响应返回给 AI 助手

#### TODO 数据流程
1. **启动时** 扫描项目目录的 TODO.md 文件
2. **解析器** 将 Markdown 转换为 TodoItem 对象树
3. **数据模型** 为 QML 提供数据绑定
4. **用户操作** 触发状态变更
5. **自动保存** 将变更写回 TODO.md 文件

## 🎨 用户体验设计

### 设计原则
1. **简洁性**: 界面简洁，功能聚焦
2. **一致性**: 遵循 Material Design 规范
3. **响应性**: 快速响应用户操作
4. **可访问性**: 支持键盘导航和快捷键

### 界面布局

#### 主界面结构
```
┌─────────────────────────────────────────┐
│              摘要显示区                  │
│         (AI 工作总结)                   │
└─────────────────────────────────────────┘
┌─────────────┬───────────────────────────┐
│   TODO列表   │        详情面板           │
│             │                          │
│ ├─ 任务1     │   选中任务的详细信息        │
│ ├─ 任务2     │                          │
│ └─ 任务3     │                          │
├─────────────┼───────────────────────────┤
│             │        输入区域           │
│             │                          │
│             │ [文本输入框]               │
│             │ [🎤] [📤发送] [☑️提交]     │
└─────────────┴───────────────────────────┘
```

#### 交互设计
- **分割面板**: 可拖拽调整各区域大小
- **上下文菜单**: 右键显示操作选项
- **状态指示**: 清晰的视觉反馈
- **快捷操作**: 双击、拖拽等便捷操作

### 响应式设计
- **最小窗口**: 400x300 像素
- **默认窗口**: 623x631 像素
- **自适应布局**: 根据窗口大小调整组件
- **高DPI支持**: 适配高分辨率显示器

## 🔧 开发规范

### 代码规范
- **Python**: 遵循 PEP 8，使用 black 格式化
- **QML**: 遵循 Qt 官方 QML 编码规范
- **Git**: 使用 Conventional Commits 规范

### 项目结构
```
VC-Buddy-MCP/
├── buddy/                  # 主要代码包
│   ├── server/            # MCP 服务器
│   ├── client/            # MCP 客户端
│   ├── ui/                # GUI 界面
│   │   ├── qml/          # QML 文件
│   │   ├── *.py          # Python 模块
│   └── tests/             # 单元测试
├── docs/                  # 文档目录
├── pyproject.toml         # 项目配置
├── Makefile              # 开发任务
└── README.md             # 项目说明
```

### 测试策略
- **单元测试**: 核心模块 100% 覆盖
- **集成测试**: MCP 服务器和 GUI 集成
- **手动测试**: 用户界面和交互测试
- **自动化测试**: CI/CD 流水线集成

## 📊 性能要求

### 响应时间
- **GUI 启动**: < 2 秒
- **TODO 解析**: < 500ms (1000+ 任务)
- **语音转写**: < 10 秒 (30 秒录音)
- **MCP 响应**: < 100ms

### 资源占用
- **内存使用**: < 100MB (正常使用)
- **CPU 占用**: < 5% (空闲状态)
- **磁盘空间**: < 50MB (安装包)

### 兼容性
- **Python**: 3.11+
- **操作系统**: macOS 10.15+, Ubuntu 20.04+, Windows 10+
- **Qt 版本**: 6.6+
- **屏幕分辨率**: 1280x720 最小支持

## 🔒 安全考虑

### 数据安全
- **本地存储**: 所有数据存储在本地
- **API 密钥**: 环境变量管理，不存储在配置文件
- **文件权限**: 配置文件使用适当的文件权限

### 网络安全
- **HTTPS**: 所有外部 API 调用使用 HTTPS
- **API 限制**: 合理的 API 调用频率限制
- **错误处理**: 不泄露敏感信息的错误消息

## 🚀 部署方案

### 安装方式
1. **源码安装**: 通过 Git 克隆和 uv 安装
2. **包管理器**: 未来支持 pip/conda 安装
3. **二进制包**: 未来提供可执行文件

### 配置部署
1. **Claude Desktop**: 配置 MCP 服务器连接
2. **环境变量**: 设置必要的 API 密钥
3. **项目配置**: 在项目目录创建配置文件

### 更新机制
- **手动更新**: Git pull + uv sync
- **版本检查**: 启动时检查新版本
- **配置迁移**: 自动迁移旧版本配置

## 📈 发展路线图

### v0.1.0 (当前版本)
- ✅ MCP 服务器基础功能
- ✅ QML 界面和 TODO 管理
- ✅ 语音输入功能
- ✅ 配置管理系统

### v0.2.0 (短期目标)
- [ ] 插件系统架构
- [ ] 多主题支持
- [ ] 性能优化
- [ ] 单元测试完善

### v0.3.0 (中期目标)
- [ ] 多语言界面支持
- [ ] 云同步功能
- [ ] 团队协作特性
- [ ] 移动端支持

### v1.0.0 (长期目标)
- [ ] 完整的生态系统
- [ ] 企业级功能
- [ ] 商业化支持
- [ ] 社区插件市场

## 📝 附录

### 相关文档
- [项目结构文档](ProjectStructure.md)
- [配置管理文档](README_CONFIG.md)
- [API 文档](api.md) (待创建)
- [用户手册](user-guide.md) (待创建)

### 外部依赖
- [FastMCP](https://github.com/jlowin/fastmcp): MCP 服务器框架
- [PySide6](https://doc.qt.io/qtforpython/): Qt Python 绑定
- [OpenAI API](https://platform.openai.com/docs/api-reference): 语音转写服务

### 许可证
本项目采用 MIT 许可证，详见 [LICENSE](../LICENSE) 文件。

---

**文档维护**: 本文档应随产品功能更新而及时更新，确保与实际实现保持一致。 